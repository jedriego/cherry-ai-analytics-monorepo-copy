## Model: `sf_case_info_xf`

`sf_case_info_xf`

*   **Unique ID:** `model.cherry_data_model.sf_case_info_xf`
*   **FQN:** `prod.salesforce_marts.sf_case_info_xf`
*   **Description:** **Current Salesforce Case Information with Risk Management Context**
This model provides the most recent state of Salesforce cases enriched with critical risk management  and performance data, serving as the primary source for current case analysis across multiple business  functions. The model takes daily snapshots of case information and applies sophisticated deduplication  logic to ensure only the latest record for each case is returned, while enriching cases with review  recommendations, health scores, and performance assessments.
**Key Business Logic:** - **Current State Focus**: Uses qualify clause with row_number() over case_id ordered by dbt_updated_at desc 
  to ensure only the most recent snapshot record per case is returned
- **Risk Management Integration**: Enriches cases with review recommendations and status for merchants 
  undergoing performance reviews and recovery interventions
- **Multi-Dimensional Scoring**: Combines web review scores from merchant health assessments with 
  mystery shopping evaluations for comprehensive case context
- **Record Type Filtering**: Applies specific logic for different case types, particularly 'In-Review Feedback' 
  and 'Web Review' cases with targeted enrichment strategies

**Critical Staging Model Context:** Based on research of staging models, this model integrates: - **sf_case_info_snapshot**: Daily snapshots of enriched case data with review context and performance scores - **sf_case_info**: Staging model that joins Salesforce cases with review recommendations, review status, 
  web review scores, and mystery shopping data
- **src_sf_cases**: Raw Salesforce case data including case details, status, record types, and business context - **review_recommendations_xf**: Automated recommendations for merchant recovery based on performance analytics - **reviews**: Active review periods and decisions for merchants under review/recovery programs - **merchant_health_score_daily**: Daily health assessments including web review scores for practice evaluation - **mystery_shopping_valids**: Look position assessments and mystery shopping evaluations for case context
**Record Type Context:** - **'012Ql000000Icd7IAC'**: In-Review Feedback cases linked to review recommendations and status - **'012Ql000000EOqTIAW'**: Web Review cases enriched with latest web review scores - **'012Ql000000LWMfIAO'**: Practice Risk Severity Alert cases for high-risk merchant notifications
**Primary Use Cases:** - Current case status reporting and analysis - Risk management case tracking with merchant context - Review and recovery program case management - Performance assessment case enrichment - Customer support case prioritization with business context
**Grain:** One record per case_id (deduplicated by latest dbt_updated_at timestamp)

*   **Tags:** `['salesforce']`
*   **Meta:** `{'monitoring': {'+tags': ['monitoring_metrics'], '+schema': 'monitoring'}}`
*   **Columns:**
    | Name | Index | Type | Comment | Description | Tags | Meta |
    |------|-------|------|---------|-------------|------|------|
    | `CASE_ID` | 1 | `TEXT` | **Salesforce Case Primary Key**
Unique identifier for each Salesforce case record. Serves as the primary key for this model  and enables joining with other case-related data sources, task management systems, and  customer interaction tracking.
 | **Salesforce Case Primary Key**
Unique identifier for each Salesforce case record. Serves as the primary key for this model  and enables joining with other case-related data sources, task management systems, and  customer interaction tracking.
 | `[]` | `{}` |
    | `ACCOUNT_ID` | 2 | `TEXT` | **Associated Salesforce Account**
Foreign key linking the case to its associated Salesforce account, enabling analysis of case  volumes by merchant/practice and integration with account-level performance data, review status,  and business intelligence.
 | **Associated Salesforce Account**
Foreign key linking the case to its associated Salesforce account, enabling analysis of case  volumes by merchant/practice and integration with account-level performance data, review status,  and business intelligence.
 | `[]` | `{}` |
    | `REVIEW_RECOMMENDATION_NOTES` | 3 | `TEXT` | **Automated Review Recommendations**
System-generated recommendations from the review_recommendations_xf model providing specific,  actionable guidance for merchant recovery and retention. These notes are generated by business  rules analyzing merchant performance across multiple dimensions (financing volume, conversion rates,  policy types, competitive positioning) and provide tailored advice for addressing specific challenges.
**Context**: Only populated for In-Review Feedback cases (record_type_id = '012Ql000000Icd7IAC')  where the case creation date falls within the associated review period, ensuring recommendations  are contextually relevant to the merchant's review timeline.
 | **Automated Review Recommendations**
System-generated recommendations from the review_recommendations_xf model providing specific,  actionable guidance for merchant recovery and retention. These notes are generated by business  rules analyzing merchant performance across multiple dimensions (financing volume, conversion rates,  policy types, competitive positioning) and provide tailored advice for addressing specific challenges.
**Context**: Only populated for In-Review Feedback cases (record_type_id = '012Ql000000Icd7IAC')  where the case creation date falls within the associated review period, ensuring recommendations  are contextually relevant to the merchant's review timeline.
 | `[]` | `{}` |
    | `REVIEW_STATUS` | 4 | `TEXT` | **Current Review Program Status**
Derived status indicating the merchant's current position in Cherry's review and recovery program.  Uses sophisticated business logic to determine status based on review timeline and outcomes:
**Status Values:** - **'Open'**: Merchant currently under active review with open status - **'Standard Menu'**: Review completed, merchant moved to standard menu due to 'low health' exit - **'Trending - Recovered'**: Review completed with 'Recovering' outcome, indicating successful intervention - **'Trending - [Outcome]'**: Currently under review with specified interim outcome (e.g., 'Trending - Maintain') - **[Review Outcome]**: Final review decision for completed reviews (e.g., 'Maintain', 'Low Health')
**Business Logic**: Prioritizes current review status, then applies timeline-based logic using  review_end_date compared to current_date() to determine if review is active or completed.
 | **Current Review Program Status**
Derived status indicating the merchant's current position in Cherry's review and recovery program.  Uses sophisticated business logic to determine status based on review timeline and outcomes:
**Status Values:** - **'Open'**: Merchant currently under active review with open status - **'Standard Menu'**: Review completed, merchant moved to standard menu due to 'low health' exit - **'Trending - Recovered'**: Review completed with 'Recovering' outcome, indicating successful intervention - **'Trending - [Outcome]'**: Currently under review with specified interim outcome (e.g., 'Trending - Maintain') - **[Review Outcome]**: Final review decision for completed reviews (e.g., 'Maintain', 'Low Health')
**Business Logic**: Prioritizes current review status, then applies timeline-based logic using  review_end_date compared to current_date() to determine if review is active or completed.
 | `[]` | `{}` |
    | `WEB_REVIEW_SCORE` | 5 | `NUMBER` | **Web Review Performance Score**
Latest web review score from merchant health assessments, providing a quantitative measure of  the merchant's online reputation and review performance. Sourced from the most recent assessment  in merchant_health_score_daily for merchants associated with Web Review cases.
**Context**: Primarily populated for Web Review cases (record_type_id = '012Ql000000EOqTIAW')  to provide performance context for web review-related case management and merchant communication.
 | **Web Review Performance Score**
Latest web review score from merchant health assessments, providing a quantitative measure of  the merchant's online reputation and review performance. Sourced from the most recent assessment  in merchant_health_score_daily for merchants associated with Web Review cases.
**Context**: Primarily populated for Web Review cases (record_type_id = '012Ql000000EOqTIAW')  to provide performance context for web review-related case management and merchant communication.
 | `[]` | `{}` |
    | `MYSTERY_SHOPPING_SCORE` | 6 | `NUMBER` | **Mystery Shopping Assessment Score**
Look position assessment score from mystery shopping evaluations, providing insights into the  merchant's competitive positioning and visibility in Cherry financing options during the customer  checkout experience. Sourced from the most recent valid mystery shopping assessment.
**Use Cases**: Used for competitive analysis, merchant coaching on financing presentation,  and understanding why certain merchants may have lower financing adoption rates despite  strong business fundamentals.
 | **Mystery Shopping Assessment Score**
Look position assessment score from mystery shopping evaluations, providing insights into the  merchant's competitive positioning and visibility in Cherry financing options during the customer  checkout experience. Sourced from the most recent valid mystery shopping assessment.
**Use Cases**: Used for competitive analysis, merchant coaching on financing presentation,  and understanding why certain merchants may have lower financing adoption rates despite  strong business fundamentals.
 | `[]` | `{}` |
    | `MAX_TIMESTAMP` | 7 | `TIMESTAMP_TZ` | **Record Freshness Indicator**
Timestamp indicating when the underlying case data was last modified, derived from the  greatest timestamp across all contributing data sources in the sf_case_info staging model. 
**Snapshot Logic**: This timestamp drives the snapshot strategy in sf_case_info_snapshot,  triggering new snapshot records when case data changes. The qualify clause in this model  uses dbt_updated_at (when the snapshot record was created) rather than this business timestamp  to ensure the most recent snapshot is selected.
**Use Cases**: Data freshness monitoring, change detection for downstream processes,  and understanding when case-related business data was last updated. | **Record Freshness Indicator**
Timestamp indicating when the underlying case data was last modified, derived from the  greatest timestamp across all contributing data sources in the sf_case_info staging model. 
**Snapshot Logic**: This timestamp drives the snapshot strategy in sf_case_info_snapshot,  triggering new snapshot records when case data changes. The qualify clause in this model  uses dbt_updated_at (when the snapshot record was created) rather than this business timestamp  to ensure the most recent snapshot is selected.
**Use Cases**: Data freshness monitoring, change detection for downstream processes,  and understanding when case-related business data was last updated. | `[]` | `{}` |
    | `DBT_SCD_ID` | 8 | `TEXT` |  |  | `[]` | `{}` |
    | `DBT_UPDATED_AT` | 9 | `TIMESTAMP_NTZ` |  |  | `[]` | `{}` |
    | `DBT_VALID_FROM` | 10 | `TIMESTAMP_NTZ` |  |  | `[]` | `{}` |
    | `DBT_VALID_TO` | 11 | `TIMESTAMP_NTZ` |  |  | `[]` | `{}` |
*   **Depends On (Parents):**
    *   `snapshot.cherry_data_model.sf_case_info_snapshot`

---
